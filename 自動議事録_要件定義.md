【改訂版】システム要件定義書：Gemini APIを利用したGUI議事録作成ツール
(ガイドライン適用版)
1. 概要
（変更なし）本システムは、ユーザーが指定した音声ファイルまたは動画ファイルの内容をGoogle Gemini APIを利用して解析し、構造化された議事録テキストを生成するデスクトップGUIアプリケーションである。生成された議事録は、ユーザーが指定した場所にテキストファイル（Markdown形式推奨）として保存できる。
2. 目的
（変更なし）
会議やインタビューなどの音声/動画記録から、手作業による議事録作成の手間を削減する。
Gemini APIの高度な音声認識・要約能力を活用し、効率的に議事録のドラフトを作成する。
GUIを提供し、プログラミング知識がないユーザーでも容易に利用できるようにする。
3. スコープ
（変更なし）
対象機能: GUIによるファイル選択、ファイルアップロード(File API)、Gemini API連携、結果受信、結果保存、進捗表示、エラーハンドリング。
対象外機能: リアルタイム処理、バッチ処理、GUI内編集、話者分離、詳細設定、認証。
4. 機能要件（タスク分割形式）
ここでは、主要な機能要件を具体的な実装タスクに分解し、ガイドラインの構造化形式で記述します。
【タスク FR-01-T1】GUIメインウィンドウの初期レイアウト実装
タスク名: GUIメインウィンドウの初期レイアウト実装
作業内容:
tkinterを使用してメインウィンドウ (tk.Tk) を作成する。
ウィンドウタイトルを「Gemini 議事録作成ツール」に設定する。
ウィンドウの初期サイズを適切に設定する（例: 650x250）。
ウィンドウ内に、ファイル選択エリア用フレーム、実行ボタン用フレーム、進捗/ステータス表示用フレームを配置する。
成果物:
ウィンドウが表示され、タイトルとサイズが設定されたPythonスクリプト。
主要なエリア（ファイル選択、実行ボタン、ステータス）の配置が完了した状態のGUI。
完了条件:
スクリプト実行時に指定されたタイトルとサイズのウィンドウが表示される。
ウィンドウ内にファイル選択、実行ボタン、ステータス表示のためのスペースが確保されている（フレームが配置されている）。
【タスク FR-02-T1 & FR-03-T1】ファイル選択機能と選択パス表示の実装
タスク名: ファイル選択機能と選択パス表示の実装
作業内容:
ファイル選択エリア用フレーム内に、ラベル「音声/動画ファイル:」、読み取り専用のテキスト入力欄 (tk.Entry)、および「参照...」ボタン (tk.Button) を配置する。
「参照...」ボタンがクリックされた際に呼び出されるコールバック関数 (browse_file) を実装する。
browse_file 関数内で tkinter.filedialog.askopenfilename を使用し、ファイル選択ダイアログを表示させる。
ファイル選択ダイアログの filetypes オプションに、サポートする音声/動画形式（例: *.mp3, *.wav, *.mp4 など）を指定する。
ファイルが選択された場合、取得したファイルパスをテキスト入力欄に表示する。
ファイルパスを保持するための tkinter.StringVar を使用し、テキスト入力欄と連携させる。
成果物:
ファイル選択用のGUIコンポーネント（ラベル、入力欄、ボタン）が配置されたコード。
browse_file 関数の実装コード。
選択されたファイルパスがGUI上に表示される機能。
完了条件:
GUI上にファイル選択欄と「参照...」ボタンが表示されている。
「参照...」ボタンクリックでファイル選択ダイアログが表示され、指定形式でフィルタリングされる。
ファイルを選択すると、そのパスがテキスト入力欄に表示される。
【タスク FR-04-T1 & FR-05-T1】実行ボタン制御とバックグラウンド処理開始の実装
タスク名: 実行ボタン制御とバックグラウンド処理開始の実装
作業内容:
実行ボタン用フレーム内に「議事録を作成して保存」ボタン (tk.Button) を配置する。初期状態は無効 (state=tk.DISABLED) とする。
ファイルが選択された際（タスク FR-02-T1完了後）、かつAPIキーが有効である場合に、実行ボタンを有効 (state=tk.NORMAL) にする処理を追加する。 (APIキーチェックは別途タスク FR-14-T1 で実装)
実行ボタンがクリックされた際に呼び出されるコールバック関数 (start_generation) を実装する。
start_generation 関数内で、現在処理中でないことを確認するフラグ (is_processing) をチェックする。
処理中でなければ、is_processing フラグを True に設定し、実行ボタンを無効化する。
threading.Thread を使用して、時間のかかる議事録生成処理（ファイルアップロード、API呼び出し等を含む関数 generation_thread）をバックグラウンドで実行する。
generation_thread に選択されたファイルパスを引数として渡す。
generation_thread 完了時（成功・失敗問わず）に is_processing フラグを False に戻し、実行ボタンの状態を再評価する処理を finally 節などで実装する。
成果物:
有効/無効が切り替わる実行ボタンのGUIコード。
start_generation 関数の実装コード。
threading を利用してバックグラウンド処理を開始するコード。
処理中状態を管理するフラグとUI制御ロジック。
完了条件:
初期状態では実行ボタンが無効である。
ファイルを選択すると（かつAPIキーが有効なら）実行ボタンが有効になる。
実行ボタンをクリックすると、ボタンが無効になり、バックグラウンド処理が開始される（コンソールログ等で確認）。
バックグラウンド処理が完了すると、ボタンが再度有効（またはファイル未選択時の無効状態）に戻る。
【タスク FR-06-T1 & FR-12-T1】Gemini File APIによるファイルアップロードと削除の実装
タスク名: Gemini File APIによるファイルアップロードと削除の実装
作業内容:
バックグラウンド処理関数 (generation_thread) 内で、 google.generativeai.upload_file(path=filepath) を呼び出し、選択されたファイルをアップロードする。
アップロード処理中は進捗ステータスを更新する（タスク FR-08-T1）。
upload_file が返す File オブジェクトを取得し、state が ACTIVE になるまでポーリング（time.sleep と genai.get_file を使用）または適切な待機処理を行う。PROCESSING 状態の間も進捗を表示する。
state が ACTIVE にならなかった場合はエラー処理を行う。
generation_thread の finally ブロック内で、取得した File オブジェクトの name を使用し、google.generativeai.delete_file(name=file_name) を呼び出してアップロードされた一時ファイルを削除する。
ファイル削除処理中もステータスを表示し、削除に失敗した場合もエラーログを出力する（処理自体は続行する）。
成果物:
genai.upload_file を呼び出すコード。
アップロードされたファイルの state を確認し、ACTIVE になるまで待機するコード。
genai.delete_file を finally ブロックで呼び出すコード。
完了条件:
指定されたファイルがエラーなく Google Cloud Storage にアップロードされる（APIの内部動作）。
アップロードされたファイルの state が ACTIVE になったことがプログラムで確認できる。
処理完了後、アップロードされたファイルがエラーなく削除される（APIの内部動作）。
削除エラーが発生した場合でも、プログラムが停止せず、ログが出力される。
【タスク FR-07-T1 & FR-10-T1】Gemini APIへのリクエストと結果受信の実装
タスク名: Gemini APIへのリクエストと結果受信の実装
作業内容:
generation_thread 内で、ファイルが ACTIVE 状態になった後、genai.GenerativeModel(model_name) でモデルオブジェクトを初期化する。
モデルオブジェクトの generate_content() メソッドを呼び出す。引数には、アップロードされたファイルオブジェクト (File オブジェクト) と、定義済みの議事録作成用プロンプト (PROMPT 変数) をリストで渡す。
generate_content() のレスポンス (response) から、生成されたテキスト (response.text) を取得する。
API呼び出し中にエラーが発生した場合（google.api_core.exceptions など）に備え、try...except ブロックで囲む（タスク FR-15-T1）。
成果物:
GenerativeModel を初期化し、generate_content を呼び出すコード。
APIレスポンスからテキストを取得するコード。
完了条件:
generate_content がエラーなく呼び出される。
APIから返却されたレスポンスオブジェクトが取得できる。
レスポンスオブジェクトから生成されたテキストが正常に抽出できる。
【タスク FR-08-T1 & FR-09-T1】処理進捗表示（ステータスとプログレスバー）の実装
タスク名: 処理進捗表示（ステータスとプログレスバー）の実装
作業内容:
進捗/ステータス表示用フレーム内に、ステータス表示用ラベル (tk.Label) とプログレスバー (ttk.Progressbar) を配置する。
ステータス表示用ラベルに tkinter.StringVar を関連付ける。
プログレスバーに tkinter.DoubleVar を関連付け、maximum=100 に設定する。
バックグラウンドスレッド (generation_thread) からGUI要素を安全に更新するためのコールバック関数 (update_status, update_progress) をGUIクラス内に実装する。これらの関数は内部で master.after(0, ...) を使用してメインスレッドでGUI更新を実行する。
generation_thread 内の各処理ステップ（開始、ファイルアップロード開始、アップロード中、アップロード完了/処理中、API呼び出し中、生成完了、一時ファイル削除中、完了/エラー）で、適切なメッセージと進捗率（0-100）を引数として、これらのコールバック関数を呼び出す。
成果物:
ステータスラベルとプログレスバーが配置されたGUIコード。
GUI更新用のコールバック関数 (update_status, update_progress) の実装コード。
バックグラウンド処理の各段階でコールバック関数を呼び出すコード。
完了条件:
GUI上にステータスラベルとプログレスバーが表示される。
処理の進行に合わせて、ステータスラベルのテキストが変化する。
処理の進行に合わせて、プログレスバーの表示が変化する。
GUIの更新がメインスレッドで行われ、エラーが発生しない。
【タスク FR-11-T1】結果のファイル保存機能の実装
タスク名: 結果のファイル保存機能の実装
作業内容:
generation_thread で議事録テキストの生成に成功した後、メインスレッドで実行されるファイル保存処理 (save_result) を呼び出す（master.after を使用）。
save_result 関数内で tkinter.filedialog.asksaveasfilename を呼び出し、ファイル保存ダイアログを表示する。
保存ダイアログの initialfile にデフォルトのファイル名（例: 元のファイル名 + _minutes.md）を提案する。
defaultextension=".md" を設定し、filetypes でMarkdownとテキストファイルを指定する。
ユーザーが保存場所とファイル名を指定した場合、指定されたパスに、受け取った議事録テキストをUTF-8エンコーディングで書き込む。
ファイル保存が正常に完了した旨をステータス表示やメッセージボックスでユーザーに通知する（タスク FR-17-T1）。
ファイル保存中にエラーが発生した場合のエラーハンドリングを行う（タスク FR-16-T1）。
ユーザーが保存をキャンセルした場合の処理（ステータス更新など）も考慮する。
成果物:
save_result 関数の実装コード。
ファイル保存ダイアログを表示し、ユーザー入力を受け付ける機能。
指定されたファイルパスにテキストを書き込むコード。
完了条件:
議事録生成成功後、ファイル保存ダイアログが表示される。
デフォルトのファイル名と拡張子が提案される。
ユーザーが指定した場所に、指定したファイル名で議事録テキストが保存される。
保存完了またはキャンセルがユーザーに通知される。
【タスク FR-13-T1 ～ FR-16-T1】エラーハンドリングの実装
タスク名: 各種エラーハンドリングの実装
作業内容:
(FR-13) ファイル選択時や処理開始時に、指定されたファイルパスが存在するか os.path.exists() などで確認し、存在しない場合は messagebox.showerror で通知する。
(FR-14) アプリケーション起動時および処理開始前に、APIキー (GOOGLE_API_KEY) が設定されているか（初期値でないか）を確認する。設定されていない場合は messagebox.showwarning または showerror で通知し、処理を実行できないようにする。
(FR-15) generation_thread 内の Gemini API 呼び出し（upload_file, get_file, generate_content, delete_file）を try...except ブロックで囲み、google.api_core.exceptions (例: PermissionDenied, ResourceExhausted, InternalServerError) やその他の関連エラーを捕捉する。捕捉したエラーは messagebox.showerror でユーザーに通知し、ステータス表示も更新する。
(FR-16) ファイル保存処理 (save_result 関数内) でのファイル書き込み (open(), write()) を try...except ブロックで囲み、IOError や OSError などの例外を捕捉する。捕捉したエラーは messagebox.showerror でユーザーに通知する。
エラー発生時は、プログレスバーの表示をリセットまたはエラー状態を示すように更新する。
成果物:
ファイル存在チェックのコード。
APIキーチェックのコード。
API呼び出し部分の try...except ブロックとエラーハンドリングコード。
ファイル書き込み部分の try...except ブロックとエラーハンドリングコード。
エラーメッセージを表示する messagebox 呼び出しコード。
完了条件:
存在しないファイルを選択して処理を開始しようとすると、エラーメッセージが表示され、処理が中断される。
APIキーが未設定の状態で処理を開始しようとすると、エラーメッセージが表示され、処理が中断される。
API通信中に権限エラーやリソース枯渇エラーなどが発生した場合、エラーメッセージが表示され、処理が中断される。
ファイル保存時に書き込み権限がない等のエラーが発生した場合、エラーメッセージが表示される。
予期せぬエラーが発生した場合も、アプリケーションがクラッシュせず、可能な限りエラー情報がユーザーに通知される。
【タスク FR-17-T1】完了通知の実装
タスク名: 完了通知の実装
作業内容:
ファイル保存が正常に完了した後（タスク FR-11-T1 の成功時）、messagebox.showinfo を使用して、処理が成功しファイルが保存された旨と保存先のパスをユーザーに通知する。
ステータスラベルにも「完了しました」などのメッセージを表示する。
成果物:
正常完了時に messagebox.showinfo を呼び出すコード。
完了メッセージをステータスラベルに表示するコード。
完了条件:
議事録の生成と保存が成功した場合、成功を示すメッセージボックスが表示される。
ステータスラベルに完了を示すメッセージが表示される。
5. 非機能要件
（変更なし、ただし上記タスク実装時に考慮される）
NFR-01 UI応答性: タスク FR-04-T1, FR-06-T1, FR-07-T1 において threading を使用して担保する。
NFR-02 使いやすさ: タスク FR-01-T1, FR-02-T1, FR-11-T1 などで直感的なUI要素とフローを実装する。
NFR-03 パフォーマンス: API応答時間は外部要因だが、アプリ自体のコードは効率的に記述する。
NFR-04 信頼性: タスク FR-13-T1 ～ FR-16-T1 のエラーハンドリングで担保する。
NFR-05 セキュリティ: APIキーはコード直書きだが、将来的な改善を視野に入れる。
NFR-06 保守性: クラス (MinutesApp) や関数 (generate_minutes_from_audio 等) に分割し、適切な命名規則とコメントを付与する。
NFR-07 互換性: 標準ライブラリとクロスプラットフォーム対応のライブラリ (tkinter, google-generativeai) を使用する。
6. 技術要件・制約
（変更なし）
7. ユーザーインターフェース（概念）
（変更なし）
8. その他
（変更なし）
この改訂版要件定義書では、各機能要件を具体的な「タスク」に分解し、「作業内容」「成果物」「完了条件」を明記しました。これにより、開発者（人間またはAI）が担当すべき作業とそのゴールが明確になり、実装の精度と効率が向上することが期待されます。CursorのようなAIコーディングアシスタントに指示を与える際にも、これらのタスク単位で指示を出すことで、より的確なコード生成が可能になるでしょう。